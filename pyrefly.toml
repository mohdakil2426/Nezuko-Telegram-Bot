# ═══════════════════════════════════════════════════════════════════════════════
# PYREFLY - Meta's Python Type Checker
# Docs: https://pyrefly.org/
# ═══════════════════════════════════════════════════════════════════════════════

# ─────────────────────────────────────────────────────────────────────────────────
# Source Code Inclusion
# ─────────────────────────────────────────────────────────────────────────────────
# Target the monorepo apps structure
project-includes = ["apps/bot", "apps/api/src"]

# Exclusion Patterns
project-excludes = [
    "**/tests/**",
    "**/venv/**",
    "**/__pycache__/**",
    "**/.git/**",
    "**/node_modules/**",
    "**/apps/web/**",
    "**/.agent/**",
    "**/alembic/versions/**",      # Alembic auto-generated migrations
]

# Respect .gitignore
use-ignore-files = true

# ─────────────────────────────────────────────────────────────────────────────────
# Environment Configuration
# ─────────────────────────────────────────────────────────────────────────────────
python-version = "3.13"
python-platform = "windows"

# ─────────────────────────────────────────────────────────────────────────────────
# Search Paths
# ─────────────────────────────────────────────────────────────────────────────────
# Order matters: project roots first, then venv site-packages for third-party
search-path = [
    ".",                           # Project root (for apps.bot, apps.api imports)
    "apps/api",                    # API app root (for src.* imports)
    "apps/bot",                    # Bot app root
    ".venv/Lib/site-packages",     # Third-party packages (Windows venv)
]

# ─────────────────────────────────────────────────────────────────────────────────
# Type Checking Strictness
# ─────────────────────────────────────────────────────────────────────────────────
# Ensures function bodies without return annotations are still checked
untyped-def-behavior = "check-and-infer-return-type"

# Generated Code
ignore-errors-in-generated-code = true

# ─────────────────────────────────────────────────────────────────────────────────
# Import Handling
# ─────────────────────────────────────────────────────────────────────────────────
# Suppress false positives for packages that don't ship py.typed / stubs
# These are packages installed in the venv but Pyrefly can't resolve their types
ignore-missing-imports = [
    "alembic",                     # Alembic has no inline types
    "apscheduler",                 # APScheduler has no inline types
    "prometheus_client",           # No stubs available
    "sentry_sdk",                  # No stubs available
]

replace-imports-with-any = []

# ─────────────────────────────────────────────────────────────────────────────────
# Error Configuration
# ─────────────────────────────────────────────────────────────────────────────────
[errors]
# No errors disabled — we want full strictness.
# Individual false positives are handled via ignore-missing-imports above
# and project-excludes for auto-generated code (Alembic migrations).
