# Specification: Real-Time Dashboard Updates

## Overview

This specification defines the real-time update feature for the dashboard, enabling live logs, activity feeds, and analytics updates without manual refresh.

## Actors

- **Owner**: The authenticated dashboard owner
- **Bot**: The Telegram bot(s) that generate events

---

## Feature: Real-Time Activity Feed

### Scenario: Live activity updates

- **GIVEN** the owner is viewing the dashboard
- **WHEN** a bot performs an action (verify user, kick user, new member, etc.)
- **THEN** the activity feed updates automatically within 1-2 seconds
- **AND** the new activity appears at the top of the list
- **AND** no page refresh is required

### Scenario: Activity types shown in real-time

- **GIVEN** the dashboard is connected to real-time updates
- **WHEN** events occur:
  - User verified successfully
  - User failed verification
  - User kicked from group
  - New user joined group
  - Bot added to new group
  - Bot configuration changed
- **THEN** each event appears in the activity feed immediately

### Scenario: Connection indicator

- **GIVEN** the owner is on the dashboard
- **THEN** a small indicator shows connection status:
  - ðŸŸ¢ Green dot = Connected (live updates active)
  - ðŸŸ¡ Yellow dot = Reconnecting
  - ðŸ”´ Red dot = Disconnected (manual refresh required)

---

## Feature: Real-Time Analytics

### Scenario: Live counter updates

- **GIVEN** the owner is viewing the analytics page
- **WHEN** a verification occurs
- **THEN** the verification count updates immediately
- **AND** the success/failure ratio updates
- **AND** charts animate smoothly to new values

### Scenario: Live chart updates

- **GIVEN** the owner is viewing a trend chart
- **WHEN** new data points are added
- **THEN** the chart updates with a smooth animation
- **AND** the latest data point is highlighted

---

## Feature: Real-Time Logs Page

### Scenario: Live log streaming

- **GIVEN** the owner is viewing the logs page
- **WHEN** log entries are generated by bots
- **THEN** new logs appear at the top in real-time
- **AND** logs are color-coded by type (info, warning, error)
- **AND** the owner can pause/resume live streaming

### Scenario: Log filtering with real-time

- **GIVEN** the owner has applied a filter (e.g., only errors)
- **WHEN** new logs arrive
- **THEN** only matching logs are shown
- **AND** non-matching logs are received but hidden

### Scenario: Pause live logs

- **GIVEN** the owner is viewing live logs
- **WHEN** they click "Pause"
- **THEN** the log feed stops updating visually
- **AND** new logs are buffered
- **WHEN** they click "Resume"
- **THEN** buffered logs appear in order
- **AND** live streaming resumes

---

## Feature: Real-Time Group/Channel Stats

### Scenario: Live member count

- **GIVEN** the owner is viewing a group's details
- **WHEN** members join or leave
- **THEN** the member count updates in real-time

### Scenario: Live verification queue

- **GIVEN** the owner is viewing a group
- **WHEN** users are pending verification
- **THEN** the pending count updates in real-time
- **AND** resolved verifications disappear from queue

---

## Feature: Connection Management

### Scenario: Auto-reconnect on disconnect

- **GIVEN** the real-time connection is lost
- **THEN** the system attempts to reconnect automatically
- **AND** shows "Reconnecting..." status
- **AND** resumes real-time updates when connected

### Scenario: Fallback to polling

- **GIVEN** WebSocket/SSE is not available
- **THEN** the dashboard falls back to polling every 30 seconds
- **AND** shows a note "Real-time unavailable, using polling"

### Scenario: Disconnect on logout

- **GIVEN** the owner logs out
- **THEN** the real-time connection is closed
- **AND** no further updates are received

---

## Technical Approach: Server-Sent Events (SSE)

### Why SSE over WebSocket?

| Factor         | SSE                     | WebSocket              |
| :------------- | :---------------------- | :--------------------- |
| Complexity     | Simpler                 | More complex           |
| Direction      | One-way (serverâ†’client) | Two-way                |
| Auto-reconnect | Built-in                | Manual                 |
| Compatibility  | Native browser support  | Native browser support |
| Use case       | Perfect for live feeds  | Overkill for read-only |

**Decision**: Use SSE for real-time updates (simpler, sufficient for dashboard).

### Event Types

| Event       | Data                                           |
| :---------- | :--------------------------------------------- |
| `activity`  | { type, message, timestamp, bot_id, group_id } |
| `analytics` | { metric, value, change }                      |
| `log`       | { level, message, timestamp, source }          |
| `stats`     | { group_id, member_count, pending_count }      |

---

## ADDED Requirements

### Requirement: Performance

- Real-time updates should not impact dashboard performance
- Buffer updates if more than 10/second to prevent UI lag
- Use virtualized lists for logs (handle 1000+ entries)

### Requirement: Security

- SSE endpoint must verify session
- Only send events for owner's bots
- Never include sensitive data (tokens) in events

### Requirement: Reliability

- Graceful degradation to polling if SSE fails
- Clear indication of connection status
- No data loss during reconnection
